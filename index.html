<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Showroom — Nos Réalisations</title>
<style>
/* ---------------- POLICES ---------------- */
@font-face { font-family: 'Engravers'; src: url('Police Engravers.ttf') format('truetype'); }
@font-face { font-family: 'TT Lakes'; src: url('Police TTLakes.ttf') format('truetype'); }
body {
  font-family: 'TT Lakes', sans-serif;
  margin: 0; padding: 0; text-align: center;
  color: white; background-color: black; min-height: 100vh;
  overflow-y: auto;
}
/* ---------------- HEADER ---------------- */
header {
  position: sticky; top: 0;
  background-color: black;
  padding: 10px 0px 0px 10px;
  display: flex; align-items: center;
  justify-content: space-between;
  z-index: 20;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
header::after {
  content: ""; position: absolute; bottom: -15px; left: 0;
  width: 100%; height: 15px;
  background: linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0));
  pointer-events: none; z-index: -1;
}
header img { width: 130px; height: auto; object-fit: contain; }
.page-title {
  font-family: 'Engravers'; font-size: 50px;
  letter-spacing: 2px;
  color: white;
  background: linear-gradient(90deg, rgba(255, 255, 255, 1), white);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-transform: uppercase;
  margin: 0 auto;
}
/* ---------------- SLIDESHOW ---------------- */
.slideshow-container { position: relative; width: 100%; height: 40vh; overflow: hidden; z-index: 5; }
.slideshow-container img { position: absolute; width: 100%; height: 100%; object-fit: cover; top: 0; left: 0; opacity: 0; transition: opacity 1.5s ease-in-out; }
.slideshow-container img.active { opacity: 1; }
.slideshow-gradient { position: absolute; bottom: 0; width: 100%; height: 100px; background: linear-gradient(to bottom, rgba(0,0,0,0), black); z-index: 10; }
/* ---------------- CONTENT ---------------- */
.content { margin-top: 15px; padding-bottom: 50px; position: relative; z-index: 1; }
.section { margin: 20px 0; }
.section h2 {
  font-family: 'Engravers'; font-size: 25px;
  color: white; padding: 0 16px;
  border-radius: 8px; margin-bottom: 10px;
  text-align: left;
}
/* ---------------- CAROUSEL ---------------- */
.carousel {
  width: 97.5%; display: flex; margin: 0 auto; justify-content: flex-start;
  gap: 10px; padding: 5px; overflow-x: auto; scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch; scrollbar-width: none;
  align-items: flex-start; /* pour stabiliser verticalement */
  min-height: 210px; /* ajuste pour stabiliser */
}
.carousel::-webkit-scrollbar { display: none; }
.categorie {
  flex: 0 0 140px; width: 140px; height: 200px;
  border-radius: 12px; overflow: hidden;
  box-shadow: 2px 6px 20px rgba(0,0,0,0.45);
  transform: scale(0.92); opacity: 0.6;
  transition: transform 220ms ease, opacity 220ms ease;
  scroll-snap-align: center; background: #222;
  position: relative; cursor: pointer;
}
.categorie img { width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(0.82); }
.categorie.active { transform: scale(1.08); opacity: 1; }
.overlay {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Engravers'; color: white;
  background: linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.35));
  text-align: center; padding: 10px; box-sizing: border-box;
}

/* ---------------- RESPONSIVE ---------------- */
@media (max-width: 720px) {
  header img { width: 125px; }
  .page-title { font-size: 8vw !important; line-height: 1.2; white-space: nowrap; }
  .section h2 { font-size: 20px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <img src="Photo logo groupe.png" alt="Logo Groupe">
  <h1 class="page-title">Showroom</h1>
</header>

<!-- SLIDESHOW -->
<div class="slideshow-container" id="slideshow">
  <div class="slideshow-gradient"></div>
</div>

<!-- CONTENT -->
<div class="content">
  <div class="section">
    <h2>Affûtage</h2>
    <div class="carousel" id="c-affutage"></div>
  </div>
  <div class="section">
    <h2>Fabrication</h2>
    <div class="carousel" id="c-fabrication"></div>
  </div>
  <div class="section">
    <h2>Fourniture</h2>
    <div class="carousel" id="c-fourniture"></div>
  </div>
</div>

<!-- SCRIPT -->
<script>
const sheetId = "1_84sDZMYdBImYk5pAG6HKb2pp5wqgpEUoHH9pJI727s";
const categories = {
  "Affûtage": document.getElementById("c-affutage"),
  "Fabrication": document.getElementById("c-fabrication"),
  "Fourniture": document.getElementById("c-fourniture")
};

// Fonction pour récupérer les données d'une feuille (A5 et F2)
async function fetchSheetData(sheetName) {
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
  const res = await fetch(url);
  const txt = await res.text();
  const json = JSON.parse(txt.substr(47).slice(0, -2));
  const rows = json.table.rows;
  if (!rows || rows.length === 0) return null;
  const img = rows[4].c[0] ? rows[4].c[0].v : null;  // A5
  const category = rows[1].c[0] ? rows[1].c[0].v : null; // A2
  return { img, category };
}

// Fonction pour récupérer la liste des noms de feuille depuis "Nom Onglets"
async function fetchSheetNames() {
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Nom Onglets`;
  const res = await fetch(url);
  const txt = await res.text();
  const json = JSON.parse(txt.substr(47).slice(0, -2));
  const rows = json.table.rows;
  if (!rows) return [];
  return rows.map(r => r.c[0]?.v).filter(Boolean);
}

// Création des onglets dynamiques
async function initDynamicOnglets() {
  const sheetNames = await fetchSheetNames();
  for (let sheetName of sheetNames) {
    const data = await fetchSheetData(sheetName);
    if (!data) continue;
    const { img, category } = data;
    if (!img || !categories[category]) continue;

    const a = document.createElement("a");
    a.className = "categorie";
    a.href = `souspage.html?sheet=${encodeURIComponent(sheetName)}`;

    const image = document.createElement("img");
    image.src = img;
    a.appendChild(image);

    const overlay = document.createElement("div");
    overlay.className = "overlay";
    overlay.textContent = sheetName;
    a.appendChild(overlay);

    categories[category].appendChild(a);
  }

  // Initialisation carrousels
  document.querySelectorAll('.carousel').forEach(car => {
    initPracticalInfiniteCarousel(car, 0);
  });
}

// Diaporama depuis Google Sheets
const urlSlide = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=A l'affiche`;
fetch(urlSlide)
.then(res => res.text())
.then(txt => {
  const data = JSON.parse(txt.substr(47).slice(0, -2));
  const rows = data.table.rows;
  const slideshow = document.getElementById("slideshow");
  rows.forEach((row, i) => {
    const img = document.createElement("img");
    img.src = row.c[0].v;
    if (i === 0) img.classList.add("active");
    slideshow.appendChild(img);
  });
  let current = 0;
  const images = slideshow.querySelectorAll("img");
  setInterval(() => {
    images[current].classList.remove("active");
    current = (current + 1) % images.length;
    images[current].classList.add("active");
  }, 5000);
});

// Carrousel infini
function initPracticalInfiniteCarousel(carousel, minRepeatFactor = 0) {
  const origItems = Array.from(carousel.querySelectorAll('.categorie'));
  if (!origItems.length) return;
  function prepare() {
    const visible = carousel.clientWidth || window.innerWidth;
    const targetWidth = visible * minRepeatFactor;
    while (carousel.scrollWidth < targetWidth) {
      origItems.forEach(it => {
        const clone = it.cloneNode(true);
        clone.removeAttribute('id');
        carousel.appendChild(clone);
      });
    }
    attachCenterListener();
  }
  function attachCenterListener() {
    let ticking = false;
    function onScroll() {
      if (!ticking) {
        window.requestAnimationFrame(() => { updateActiveCenter(); ticking = false; });
        ticking = true;
      }
    }
    carousel.addEventListener('scroll', onScroll, { passive: true });
    updateActiveCenter();
    window.addEventListener('resize', () => {
      clearTimeout(carousel._resizeTO);
      carousel._resizeTO = setTimeout(updateActiveCenter, 120);
    });
  }
  function updateActiveCenter() {
    const centerX = carousel.scrollLeft + carousel.clientWidth / 3;
    let closest = null;
    let minDist = Infinity;
    const items = Array.from(carousel.querySelectorAll('.categorie'));
    items.forEach(item => {
      const itemLeft = item.offsetLeft;
      const itemCenter = itemLeft + item.offsetWidth / 2;
      const dist = Math.abs(centerX - itemCenter);
      if (dist < minDist) { minDist = dist; closest = item; }
      item.classList.remove('active');
    });
    if (closest) closest.classList.add('active');
  }
  if (document.readyState === 'loading') {
    window.addEventListener('load', prepare, { once: true });
    setTimeout(prepare, 300);
  } else { prepare(); }
}

// Lancement
document.addEventListener('DOMContentLoaded', initDynamicOnglets);
</script>
</body>
</html>
